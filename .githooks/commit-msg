#!/usr/bin/env bash
# .githooks/commit-msg
# Validates commit message format and disallows forbidden markers

set -euo pipefail

MSG_FILE="$1"
HEADLINE=$(head -n1 "$MSG_FILE" | tr -d '\r')

# Allowed types
TYPE_PATTERN='^(feat|fix|refactor|docs|test|chore|feat\(atlas\)|docs\(log\)|docs\(plan\)):\s'

if ! echo "$HEADLINE" | grep -Eq "$TYPE_PATTERN"; then
  echo "‚ùå Formato de commit inv√°lido. Usa: <type>: <description>"
  echo "   Tipos permitidos: feat | fix | refactor | docs | test | chore | feat(atlas) | docs(log) | docs(plan)"
  echo "   L√≠nea detectada: '$HEADLINE'"
  exit 1
fi

# Disallow AI/co-author markers
if grep -qiE 'Co-Authored-By:|Claude|AI generated|ü§ñ' "$MSG_FILE"; then
  echo "‚ùå Marcadores de co-autor√≠a o AI detectados: prohibido seg√∫n rules"
  exit 1
fi

exit 0
